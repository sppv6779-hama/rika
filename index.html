<!doctype html>
<html lang="ja" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®‡å®™ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ã‚¨ã‚¹ãƒˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&amp;family=Noto+Sans+JP:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    .font-game {
      font-family: 'Orbitron', 'Noto Sans JP', sans-serif;
    }
    
    .font-jp {
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(5deg); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    @keyframes explosion {
      0% { transform: scale(1) rotate(0deg); opacity: 1; }
      50% { transform: scale(1.5) rotate(180deg); opacity: 0.5; }
      100% { transform: scale(2) rotate(360deg); opacity: 0; }
    }
    
    @keyframes ship-move-forward {
      0% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-30px) scale(1.2); }
      100% { transform: translateY(0) scale(1); }
    }
    
    @keyframes stars-move {
      0% { transform: translateY(0); }
      100% { transform: translateY(100%); }
    }
    
    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(-20px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes planet-arrive {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      60% { transform: scale(1.2) rotate(180deg); opacity: 1; }
      100% { transform: scale(1) rotate(360deg); opacity: 1; }
    }
    
    @keyframes rocket-flight {
      0% { 
        bottom: 0%;
        left: 50%;
        transform: translateX(-50%) scale(1) rotate(0deg);
        opacity: 1;
      }
      100% { 
        bottom: var(--flight-end);
        left: 50%;
        transform: translateX(-50%) scale(1.5) rotate(15deg);
        opacity: 1;
      }
    }
    
    @keyframes planet-pass {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0.3; transform: scale(1); }
    }
    
    @keyframes stars-twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .animate-shake {
      animation: shake 0.4s ease-in-out;
    }
    
    .animate-explosion {
      animation: explosion 0.5s ease-out forwards;
    }
    
    .animate-ship-move {
      animation: ship-move-forward 0.5s ease-out;
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
    
    .animate-planet-arrive {
      animation: planet-arrive 1s ease-out;
    }
    
    .stars-bg {
      position: relative;
      overflow: hidden;
    }
    
    .stars-bg::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      background-image: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent),
        radial-gradient(1px 1px at 33% 80%, white, transparent),
        radial-gradient(1px 1px at 15% 90%, white, transparent);
      background-size: 200px 200px;
      background-position: 0 0, 40px 60px, 130px 270px, 70px 100px, 150px 50px, 90px 180px, 30px 220px;
      animation: stars-move 20s linear infinite;
    }
    
    .stars-bg::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 70% 40%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 85% 80%, rgba(255,255,255,0.8), transparent);
      background-size: 300px 300px;
      animation: stars-twinkle 3s ease-in-out infinite;
    }
    
    .sign-board {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 152, 0, 0.2) 100%);
      border: 3px solid #ffc107;
      box-shadow: 0 0 30px rgba(255, 193, 7, 0.5), inset 0 0 20px rgba(255, 193, 7, 0.2);
    }
    
    .spaceship {
      font-size: 4rem;
      filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.8));
    }
    
    .planet-display {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 15rem;
      opacity: 0.1;
      pointer-events: none;
      z-index: 1;
      transition: opacity 0.5s ease;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full m-0 p-0 overflow-auto">
  <div id="app" class="w-full min-h-full stars-bg flex flex-col items-center justify-center p-6" style="background: linear-gradient(180deg, #000428 0%, #004e92 100%);"><!-- èƒŒæ™¯ã®æƒ‘æ˜Ÿè¡¨ç¤º -->
   <div id="planet-bg" class="planet-display">
    ğŸŒ
   </div><!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
   <div id="start-screen" class="text-center relative z-10">
    <div class="animate-float mb-8">
     <div class="text-7xl mb-6">
      ğŸš€
     </div>
     <h1 id="title" class="font-game text-5xl md:text-6xl font-black tracking-wider mb-4" style="color: #00ffff; text-shadow: 0 0 40px rgba(0, 255, 255, 0.8), 0 0 80px rgba(0, 255, 255, 0.4);">å®‡å®™ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
     <div class="font-jp text-xl mb-2" style="color: #ffd700;">
      ğŸŒŒ å®‡å®™ã‹ã‚‰ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ ğŸŒŒ
     </div>
     <p class="font-jp text-gray-300 text-lg leading-relaxed">çœ‹æ¿ã®å•é¡Œã‚’ç­”ãˆã¦æ‰“ã¡ç ´ã‚Šã€<br>
      å®‡å®™ã®å½¼æ–¹ã¸é€²ã‚ï¼</p>
    </div><button id="start-btn" class="font-game text-2xl px-16 py-5 rounded-2xl font-bold transition-all duration-300 hover:scale-110 hover:shadow-2xl" style="background: linear-gradient(135deg, #00ffff 0%, #0099ff 100%); color: #000428; box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);"> ğŸš€ å‡ºç™º </button>
    <div class="mt-10 font-jp text-gray-400 text-sm">
     <p>ğŸ’¡ çœ‹æ¿ã®å•é¡Œã«ã€ã²ã‚‰ãŒãªã‚’ãƒ­ãƒ¼ãƒå­—ã§ç­”ãˆã‚ˆã†</p>
     <p class="mt-2">5ç§’å¾Œã«ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
     <p class="mt-1 text-xs">ï¼ˆã€Œã—ã€â†’ã€Œshiã€orã€Œsiã€ã€ã€Œã‚“ã€â†’ã€Œnã€orã€Œnnã€ã©ã¡ã‚‰ã§ã‚‚OKï¼ï¼‰</p>
    </div>
   </div><!-- ã‚³ãƒ¼ã‚¹é¸æŠç”»é¢ -->
   <div id="course-screen" class="hidden text-center relative z-10 w-full max-w-4xl">
    <div class="mb-8">
     <h2 class="font-game text-4xl md:text-5xl font-black tracking-wider mb-4" style="color: #00ffff; text-shadow: 0 0 40px rgba(0, 255, 255, 0.8);">ã‚³ãƒ¼ã‚¹é¸æŠ</h2>
     <p class="font-jp text-gray-300 text-lg">æŒ‘æˆ¦ã™ã‚‹ã‚³ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"><button class="course-btn p-8 rounded-2xl font-bold transition-all duration-300 hover:scale-105" data-course="creature" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); box-shadow: 0 0 30px rgba(46, 204, 113, 0.4);">
      <div class="text-5xl mb-3">
       ğŸŒ±
      </div>
      <div class="font-jp text-2xl mb-2" style="color: white;">
       ã„ãã‚‚ã®ã‚³ãƒ¼ã‚¹
      </div>
      <div class="font-jp text-sm" style="color: rgba(255, 255, 255, 0.8);">
       æ¤ç‰©ãƒ»å‹•ç‰©ã®å•é¡Œ
      </div></button> <button class="course-btn p-8 rounded-2xl font-bold transition-all duration-300 hover:scale-105" data-course="matter" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); box-shadow: 0 0 30px rgba(231, 76, 60, 0.4);">
      <div class="text-5xl mb-3">
       âš—ï¸
      </div>
      <div class="font-jp text-2xl mb-2" style="color: white;">
       ã¶ã£ã—ã¤ã‚³ãƒ¼ã‚¹
      </div>
      <div class="font-jp text-sm" style="color: rgba(255, 255, 255, 0.8);">
       ç‰©è³ªãƒ»åŒ–å­¦ã®å•é¡Œ
      </div></button> <button class="course-btn p-8 rounded-2xl font-bold transition-all duration-300 hover:scale-105" data-course="physics" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); box-shadow: 0 0 30px rgba(243, 156, 18, 0.4);">
      <div class="text-5xl mb-3">
       ğŸ’¡
      </div>
      <div class="font-jp text-2xl mb-2" style="color: white;">
       ã²ã‹ã‚Šãƒ»ãŠã¨ãƒ»ã¡ã‹ã‚‰ã‚³ãƒ¼ã‚¹
      </div>
      <div class="font-jp text-sm" style="color: rgba(255, 255, 255, 0.8);">
       ç‰©ç†ã®å•é¡Œ
      </div></button> <button class="course-btn p-8 rounded-2xl font-bold transition-all duration-300 hover:scale-105" data-course="earth" style="background: linear-gradient(135deg, #8e44ad 0%, #6c3483 100%); box-shadow: 0 0 30px rgba(142, 68, 173, 0.4);">
      <div class="text-5xl mb-3">
       ğŸŒ‹
      </div>
      <div class="font-jp text-2xl mb-2" style="color: white;">
       ã ã„ã¡ã‚³ãƒ¼ã‚¹
      </div>
      <div class="font-jp text-sm" style="color: rgba(255, 255, 255, 0.8);">
       åœ°å­¦ã®å•é¡Œ
      </div></button>
    </div><button id="back-to-start-btn" class="font-jp text-lg px-8 py-3 rounded-xl transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.1); color: white; border: 2px solid rgba(255, 255, 255, 0.3);"> â† ã‚‚ã©ã‚‹ </button>
   </div><!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
   <div id="game-screen" class="hidden w-full max-w-6xl relative z-10 flex gap-6"><!-- ã‚µã‚¤ãƒ‰ã‚²ãƒ¼ã‚¸ -->
    <div class="hidden md:block w-32 flex-shrink-0">
     <div class="sticky top-6">
      <div class="font-jp text-sm text-center mb-3" style="color: #00ffff;">
       é€²è¡ŒçŠ¶æ³
      </div>
      <div class="relative rounded-full p-2" style="background: rgba(0, 0, 0, 0.6); border: 2px solid rgba(0, 255, 255, 0.3); height: 500px;"><!-- ã‚²ãƒ¼ã‚¸èƒŒæ™¯ -->
       <div class="absolute bottom-2 left-2 right-2 rounded-full" style="background: rgba(255, 255, 255, 0.1); top: 2px;"></div><!-- ã‚²ï¿½ï¿½ï¿½ã‚¸æœ¬ä½“ -->
       <div id="progress-gauge" class="absolute bottom-2 left-2 right-2 rounded-full transition-all duration-500" style="background: linear-gradient(to top, #00ffff, #0099ff); height: 0%; box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);"></div><!-- æƒ‘æ˜Ÿãƒãƒ¼ã‚«ãƒ¼ -->
       <div id="planet-markers" class="absolute inset-0"></div><!-- å®‡å®™èˆ¹ã‚¢ã‚¤ã‚³ãƒ³ -->
       <div id="ship-marker" class="absolute left-1/2 transform -translate-x-1/2 transition-all duration-500 text-3xl" style="bottom: 0%;">
        ğŸš€
       </div>
      </div>
      <div id="gauge-planet-name" class="font-jp text-xs text-center mt-3" style="color: #ffd700;">
       ğŸŒ åœ°çƒ
      </div>
     </div>
    </div><!-- ãƒ¡ã‚¤ãƒ³ã‚²ï¿½ï¿½ãƒ ã‚¨ï¿½ï¿½ã‚¢ -->
    <div class="flex-1"><!-- ï¿½ï¿½å®™èˆ¹ -->
     <div class="text-center mb-6">
      <div id="spaceship" class="spaceship inline-block">
       ğŸš€
      </div>
     </div><!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
     <div class="flex justify-between items-center mb-6 px-4 rounded-xl p-4" style="background: rgba(0, 0, 0, 0.5); border: 2px solid rgba(0, 255, 255, 0.3);">
      <div class="text-center">
       <div class="font-jp text-gray-400 text-sm mb-1">
        ã‚¹ã‚³ã‚¢
       </div>
       <div id="score" class="font-game text-3xl font-bold" style="color: #00ffff;">
        0
       </div>
      </div>
      <div class="text-center">
       <div class="font-jp text-gray-400 text-sm mb-1">
        ç¾åœ¨åœ°
       </div>
       <div id="location" class="font-jp text-xl font-bold" style="color: #ffd700;">
        ğŸŒ åœ°çƒ
       </div>
      </div>
      <div class="text-center">
       <div class="font-jp text-gray-400 text-sm mb-1">
        æ®‹ã‚Šæ™‚é–“
       </div>
       <div id="timer" class="font-game text-3xl font-bold" style="color: #ff6b9d;">
        60
       </div>
      </div>
      <div class="text-center">
       <div class="font-jp text-gray-400 text-sm mb-1">
        æ­£ç¢ºç‡
       </div>
       <div id="accuracy" class="font-game text-3xl font-bold" style="color: #00ff88;">
        100%
       </div>
      </div>
     </div><!-- çœ‹æ¿ï¼ˆå•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼‰ -->
     <div id="sign-board" class="sign-board rounded-3xl p-8 mb-6 relative">
      <div class="absolute top-4 left-1/2 transform -translate-x-1/2 font-jp text-sm" style="color: #ffd700;">
       ğŸ¯ çœ‹æ¿ ğŸ¯
      </div>
      <div id="word-hint" class="font-jp text-xl md:text-2xl mb-8 text-center leading-relaxed mt-4" style="color: #ffffff; min-height: 70px; text-shadow: 0 2px 4px rgba(0,0,0,0.5);"><!-- è³ªå•ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>
      <div class="font-jp text-sm mb-2 text-center" style="color: #ffd700;">
       ç­”ãˆï¼ˆãƒ­ãƒ¼ãƒå­—ã§å…¥åŠ›ï¼‰
      </div>
      <div id="current-word" class="font-jp text-3xl md:text-4xl tracking-wider text-center mb-4" style="color: white; min-height: 50px; text-shadow: 0 0 10px rgba(255,255,255,0.5);"><!-- ã²ã‚‰ãŒãªãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>
      <div id="answer-hint" class="font-jp text-lg text-center" style="color: #00ffff; min-height: 30px; opacity: 0; text-shadow: 0 0 10px rgba(0,255,255,0.8);"><!-- ãƒ­ãƒ¼ãƒå­—ãƒ’ãƒ³ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>
     </div><!-- å…¥åŠ›è¡¨ç¤º -->
     <div class="rounded-xl p-4 mb-4 text-center" style="background: rgba(0, 0, 0, 0.5); border: 2px solid rgba(0, 255, 255, 0.3);"><span id="input-display" class="font-game text-2xl tracking-wider" style="color: rgba(255, 255, 255, 0.6);">å…¥åŠ›ã—ã¦ãã ã•ã„...</span>
     </div><!-- éš ã—å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ --> <input type="text" id="hidden-input" class="opacity-0 absolute" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false"> <!-- ã‚³ãƒ³ãƒœè¡¨ç¤º -->
     <div id="combo-display" class="text-center font-game text-2xl" style="color: #ff6b9d; text-shadow: 0 0 10px rgba(255, 107, 157, 0.8);"><span id="combo-count"></span>
     </div>
    </div>
   </div><!-- çµæœç”»é¢ -->
   <div id="result-screen" class="hidden text-center max-w-2xl relative z-10"><!-- ãƒ•ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
    <div id="flight-animation" class="fixed inset-0 pointer-events-none z-50 hidden">
     <div class="relative w-full h-full">
      <div id="flight-gauge" class="absolute left-1/2 transform -translate-x-1/2 w-32" style="height: 80%; top: 10%;">
       <div class="relative h-full rounded-full p-2" style="background: rgba(0, 0, 0, 0.8); border: 3px solid rgba(0, 255, 255, 0.5);">
        <div id="flight-rocket" class="absolute text-5xl" style="bottom: 0%; left: 50%; transform: translateX(-50%);">
         ğŸš€
        </div>
        <div id="flight-planets"></div>
       </div>
      </div>
     </div>
    </div>
    <div class="mb-8 animate-fadeIn">
     <div id="final-planet-emoji" class="text-8xl mb-6">
      ğŸŒ
     </div>
     <h2 class="font-game text-4xl font-bold mb-4" style="color: #00ffff; text-shadow: 0 0 30px rgba(0, 255, 255, 0.8);">ãƒŸãƒƒã‚·ãƒ§ãƒ³å®Œäº†ï¼</h2>
     <div id="final-location" class="font-jp text-2xl mb-6" style="color: #ffd700;">
      åˆ°é”åœ°ç‚¹ï¼šğŸŒ åœ°çƒ
     </div>
     <div id="new-record-message" class="hidden font-jp text-2xl mb-6 animate-fadeIn" style="color: #ff6b9d; text-shadow: 0 0 20px rgba(255, 107, 157, 0.8);">
      ğŸ‰ ãƒˆãƒƒãƒ—10å…¥ã‚Šï¼ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ç™»éŒ²ã—ã‚ˆã†ï¼ ğŸ‰
     </div>
    </div>
    <div class="rounded-2xl p-8 mb-8" style="background: rgba(0, 0, 0, 0.6); border: 2px solid rgba(0, 255, 255, 0.4);">
     <div class="grid grid-cols-2 gap-6">
      <div class="text-center">
       <div class="font-jp text-gray-400 mb-2">
        æœ€çµ‚ã‚¹ã‚³ã‚¢
       </div>
       <div id="final-score" class="font-game text-5xl font-bold" style="color: #00ffff; text-shadow: 0 0 20px rgba(0, 255, 255, 0.6);">
        0
       </div>
      </div>
      <div class="text-center">
       <div class="font-jp text-gray-400 mb-2">
        ã‚¿ã‚¤ãƒ—æ•°
       </div>
       <div id="final-typed" class="font-game text-5xl font-bold" style="color: #00ff88;">
        0
       </div>
      </div>
      <div class="text-center">
       <div class="font-jp text-gray-400 mb-2">
        æ­£ç¢ºç‡
       </div>
       <div id="final-accuracy" class="font-game text-5xl font-bold" style="color: #ffd700;">
        100%
       </div>
      </div>
      <div class="text-center">
       <div class="font-jp text-gray-400 mb-2">
        æœ€é«˜ã‚³ãƒ³ãƒœ
       </div>
       <div id="final-combo" class="font-game text-5xl font-bold" style="color: #ff6b9d;">
        0
       </div>
      </div>
     </div>
    </div><!-- ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="nickname-form" class="hidden mb-8 rounded-xl p-6" style="background: rgba(0, 0, 0, 0.6); border: 2px solid rgba(255, 215, 0, 0.6);"><label for="nickname-input" class="font-jp text-lg mb-3 block" style="color: #ffd700;">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ6æ–‡å­—ã¾ã§ï¼‰</label>
     <div class="flex gap-3 justify-center"><input type="text" id="nickname-input" maxlength="6" class="font-jp px-4 py-3 rounded-lg text-xl text-center" style="background: rgba(255, 255, 255, 0.9); color: #000; border: 2px solid #ffd700; width: 200px;" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ "> <button id="submit-nickname-btn" class="font-jp px-6 py-3 rounded-lg font-bold transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%); color: #000;"> ç™»éŒ² </button>
     </div>
    </div><!-- éå»ã®ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ -->
    <div id="best-scores" class="mt-8 rounded-xl p-6 max-w-md mx-auto mb-8" style="background: rgba(0, 0, 0, 0.6); border: 2px solid rgba(0, 255, 255, 0.4);">
     <div class="font-jp text-lg mb-4 text-center" style="color: #ffd700;">
      ğŸ† ãƒˆãƒƒãƒ—10ãƒ©ãƒ³ã‚­ãƒ³ã‚° ğŸ†
     </div>
     <div id="best-scores-list" class="font-jp text-sm space-y-2"><!-- ã‚¹ã‚³ã‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
     </div>
    </div><button id="retry-btn" class="font-game text-2xl px-16 py-5 rounded-2xl font-bold transition-all duration-300 hover:scale-110" style="background: linear-gradient(135deg, #00ffff 0%, #0099ff 100%); color: #000428; box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);"> ğŸš€ å†æŒ‘æˆ¦ </button>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: 'å®‡å®™ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ã‚¨ã‚¹ãƒˆ',
      start_button_text: 'ğŸš€ å‡ºç™º',
      background_start: '#000428',
      background_end: '#004e92',
      primary_color: '#00ffff',
      accent_color: '#ffd700',
      danger_color: '#ff6b9d'
    };

    let config = { ...defaultConfig };

    // ã²ã‚‰ãŒãªâ†’ãƒ­ãƒ¼ãƒå­—å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¤‡æ•°å…¥åŠ›æ–¹å¼å¯¾å¿œï¼‰
    const hiraganaToRomaji = {
      'ã‚': ['a'], 'ã„': ['i'], 'ã†': ['u'], 'ãˆ': ['e'], 'ãŠ': ['o'],
      'ã‹': ['ka', 'ca'], 'ã': ['ki'], 'ã': ['ku', 'cu'], 'ã‘': ['ke'], 'ã“': ['ko', 'co'],
      'ã•': ['sa'], 'ã—': ['shi', 'si'], 'ã™': ['su'], 'ã›': ['se'], 'ã': ['so'],
      'ãŸ': ['ta'], 'ã¡': ['chi', 'ti'], 'ã¤': ['tsu', 'tu'], 'ã¦': ['te'], 'ã¨': ['to'],
      'ãª': ['na'], 'ã«': ['ni'], 'ã¬': ['nu'], 'ã­': ['ne'], 'ã®': ['no'],
      'ã¯': ['ha'], 'ã²': ['hi'], 'ãµ': ['fu', 'hu'], 'ã¸': ['he'], 'ã»': ['ho'],
      'ã¾': ['ma'], 'ã¿': ['mi'], 'ã‚€': ['mu'], 'ã‚': ['me'], 'ã‚‚': ['mo'],
      'ã‚„': ['ya'], 'ã‚†': ['yu'], 'ã‚ˆ': ['yo'],
      'ã‚‰': ['ra'], 'ã‚Š': ['ri'], 'ã‚‹': ['ru'], 'ã‚Œ': ['re'], 'ã‚': ['ro'],
      'ã‚': ['wa'], 'ã‚’': ['wo'], 'ã‚“': ['nn', 'n'],
      'ãŒ': ['ga'], 'ã': ['gi'], 'ã': ['gu'], 'ã’': ['ge'], 'ã”': ['go'],
      'ã–': ['za'], 'ã˜': ['ji', 'zi'], 'ãš': ['zu'], 'ãœ': ['ze'], 'ã': ['zo'],
      'ã ': ['da'], 'ã¢': ['di', 'ji'], 'ã¥': ['du', 'zu'], 'ã§': ['de'], 'ã©': ['do'],
      'ã°': ['ba'], 'ã³': ['bi'], 'ã¶': ['bu'], 'ã¹': ['be'], 'ã¼': ['bo'],
      'ã±': ['pa'], 'ã´': ['pi'], 'ã·': ['pu'], 'ãº': ['pe'], 'ã½': ['po'],
      'ãã‚ƒ': ['kya'], 'ãã‚…': ['kyu'], 'ãã‚‡': ['kyo'],
      'ã—ã‚ƒ': ['sha', 'sya'], 'ã—ã‚…': ['shu', 'syu'], 'ã—ã‚‡': ['sho', 'syo'],
      'ã¡ã‚ƒ': ['cha', 'tya'], 'ã¡ã‚…': ['chu', 'tyu'], 'ã¡ã‚‡': ['cho', 'tyo'],
      'ã«ã‚ƒ': ['nya'], 'ã«ã‚…': ['nyu'], 'ã«ã‚‡': ['nyo'],
      'ã²ã‚ƒ': ['hya'], 'ã²ã‚…': ['hyu'], 'ã²ã‚‡': ['hyo'],
      'ã¿ã‚ƒ': ['mya'], 'ã¿ã‚…': ['myu'], 'ã¿ã‚‡': ['myo'],
      'ã‚Šã‚ƒ': ['rya'], 'ã‚Šã‚…': ['ryu'], 'ã‚Šã‚‡': ['ryo'],
      'ãã‚ƒ': ['gya'], 'ãã‚…': ['gyu'], 'ãã‚‡': ['gyo'],
      'ã˜ã‚ƒ': ['ja', 'jya', 'zya'], 'ã˜ã‚…': ['ju', 'jyu', 'zyu'], 'ã˜ã‚‡': ['jo', 'jyo', 'zyo'],
      'ã³ã‚ƒ': ['bya'], 'ã³ã‚…': ['byu'], 'ã³ã‚‡': ['byo'],
      'ã´ã‚ƒ': ['pya'], 'ã´ã‚…': ['pyu'], 'ã´ã‚‡': ['pyo'],
      'ãµã': ['fa'], 'ãµãƒ': ['fi'], 'ãµã‡': ['fe'], 'ãµã‰': ['fo'],
      'ã‚ƒ': ['ya'], 'ã‚…': ['yu'], 'ã‚‡': ['yo'],
      'ã£': ['ltu', 'xtu', 'ltsu']
    };

    // å¤ªé™½ç³»ã®æƒ‘æ˜Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆ2000ç‚¹ã§å¤ªé™½ç³»ã®å¤–ã¸ï¼‰
    const planets = [
      { name: 'åœ°çƒ', distance: 0, emoji: 'ğŸŒ', color: '#4a90e2' },
      { name: 'æœˆ', distance: 120, emoji: 'ğŸŒ™', color: '#b8c5d6' },
      { name: 'ç«æ˜Ÿ', distance: 300, emoji: 'ğŸ”´', color: '#e74c3c' },
      { name: 'æœ¨æ˜Ÿ', distance: 550, emoji: 'ğŸŸ ', color: '#f39c12' },
      { name: 'åœŸæ˜Ÿ', distance: 850, emoji: 'ğŸª', color: '#f1c40f' },
      { name: 'å¤©ç‹æ˜Ÿ', distance: 1200, emoji: 'ğŸ”µ', color: '#3498db' },
      { name: 'æµ·ç‹æ˜Ÿ', distance: 1550, emoji: 'ğŸ’™', color: '#2980b9' },
      { name: 'å†¥ç‹æ˜Ÿ', distance: 1800, emoji: 'âš«', color: '#95a5a6' },
      { name: 'å¤ªé™½ç³»ã®å¤–', distance: 2000, emoji: 'âœ¨', color: '#9b59b6' }
    ];

    // å˜èªãƒªã‚¹ãƒˆï¼ˆã‚³ãƒ¼ã‚¹åˆ¥ï¼‰
    const wordsByCourse = {
      creature: [
        { hint: 'ã‚ã—ã¹ã®å…ˆç«¯ã«ã‚ã‚‹ã€èŠ±ï¿½ï¿½ãŒï¿½ï¿½ãéƒ¨åˆ†ã€‚', answer: 'ã¡ã‚…ã†ã¨ã†' },
        { hint: 'ãŠã—ï¿½ï¿½ã®å…ˆç«¯ã«ã‚ã‚‹ã€èŠ±ç²‰ãŒå…¥ã£ã¦ã„ã‚‹è¢‹ã€‚', answer: 'ã‚„ã' },
        { hint: 'å—ç²‰å¾Œã€æˆé•·ã—ã¦æœå®Ÿã«ãªã‚‹éƒ¨åˆ†ã€‚', answer: 'ã—ã¼ã†' },
        { hint: 'å—ç²‰å¾Œã€æˆé•·ã—ã¦ç¨®å­ã«ãªã‚‹éƒ¨åˆ†ã€‚', answer: 'ã¯ã„ã—ã‚…' },
        { hint: 'ã‚ã—ã¹ã®å…ˆã«èŠ±ç²‰ãŒã¤ãã“ã¨ã€‚', answer: 'ã˜ã‚…ãµã‚“' },
        { hint: 'èŠ½ãŒå‡ºãŸã¨ãã«ã€æœ€åˆã«å‡ºã¦ãã‚‹è‘‰ã€‚', answer: 'ã—ã‚ˆã†' },
        { hint: 'è‘‰ã«è¦‹ã‚‰ã‚Œã‚‹ã€ã™ã˜ã®ã‚ˆã†ãªã¤ãã‚Šã€‚', answer: 'ã‚ˆã†ã¿ã‚ƒã' },
        { hint: 'å­è‘‰ãŒ1æšã®è¢«å­æ¤ç‰©ã€‚', answer: 'ãŸã‚“ã—ã‚ˆã†ã‚‹ã„' },
        { hint: 'å­è‘‰ãŒ2æšã®è¢«å­æ¤ç‰©ã€‚', answer: 'ãã†ã—ã‚ˆã†ã‚‹ã„' },
        { hint: 'å¹³è¡Œã«ä¸¦ã‚“ã§ã„ã‚‹è‘‰è„ˆã€‚', answer: 'ã¸ã„ã“ã†ã¿ã‚ƒã' },
        { hint: 'å˜å­è‘‰é¡ã«è¦‹ã‚‰ã‚Œã‚‹ã€ç´°ã„æ ¹ãŒã¾ã¨ã¾ã£ãŸã‚‚ã®ã€‚', answer: 'ã²ã’ã­' },
        { hint: 'åŒå­è‘‰é¡ã«è¦‹ã‚‰ã‚Œã‚‹ã€ä¸­å¤®ã®å¤ªã„æ ¹ã€‚', answer: 'ã—ã‚…ã“ã‚“' },
        { hint: 'ä¸»æ ¹ã‹ã‚‰æåˆ†ã‹ã‚Œã—ãŸç´°ã„æ ¹ã€‚', answer: 'ãã£ã“ã‚“' },
        { hint: 'èƒšç ãŒå­æˆ¿ã®ä¸­ã«åŒ…ã¾ã‚Œã¦ã„ã‚‹æ¤ç‰©ã€‚', answer: 'ã²ã—ã—ã‚‡ãã¶ã¤' },
        { hint: 'èƒšç ãŒã‚€ãå‡ºã—ã«ãªã£ã¦ã„ã‚‹æ¤ç‰©ã€‚', answer: 'ã‚‰ã—ã—ã‚‡ãã¶ã¤' },
        { hint: 'ç¨®å­ã‚’ã¤ãã‚‰ãšã€èƒå­ã§ãµãˆã‚‹æ¤ç‰©ã€‚', answer: 'ã»ã†ã—ã—ã‚‡ãã¶ã¤' },
        { hint: 'ã‚·ãƒ€æ¤ç‰©ãªã©ã®ã€åœ°ä¸­ã«ã‚ã‚‹èŒã€‚', answer: 'ã¡ã‹ã‘ã„' },
        { hint: 'ã‚³ã‚±æ¤ç‰©ã«ã‚ã‚‹ã€ä½“ã‚’å›ºå®šã™ã‚‹æ ¹ã®ã‚ˆã†ãªéƒ¨åˆ†ã€‚', answer: 'ã‹ã“ã‚“' },
        { hint: 'èƒŒéª¨ã‚’ã‚‚ã£ã¦ã„ã‚‹å‹•ç‰©ã®ã‚°ãƒ«ãƒ¼ãƒ—ã€‚', answer: 'ã›ãã¤ã„ã©ã†ã¶ã¤' },
        { hint: 'èƒŒéª¨ã‚’ã‚‚ã£ã¦ã„ãªã„å‹•ç‰©ã®ã‚°ãƒ«ãƒ¼ãƒ—ã€‚', answer: 'ã‚€ã›ãã¤ã„ã©ã†ã¶ã¤' },
        { hint: 'è¦ªãŒåµã‚’ç”£ã¿ã€åµã‹ã‚‰å­ãŒç”Ÿã¾ã‚Œã‚‹ã“ã¨ã€‚', answer: 'ã‚‰ã‚“ã›ã„' },
        { hint: 'æ¯ä½“å†…ã§è‚²ã£ã¦ã‹ã‚‰å­ãŒç”Ÿã¾ã‚Œã‚‹ã“ã¨ã€‚', answer: 'ãŸã„ã›ã„' },
        { hint: 'å‘¨å›²ã®æ¸©åº¦ã«ã‚ˆã£ã¦ä½“æ¸©ãŒå¤‰åŒ–ã™ã‚‹å‹•ç‰©ã€‚', answer: 'ã¸ã‚“ãŠã‚“ã©ã†ã¶ã¤' },
        { hint: 'ä½“æ¸©ã‚’ã»ã¼ä¸€å®šã«ä¿ã¤å‹•ç‰©ã€‚', answer: 'ã“ã†ãŠã‚“ã©ã†ã¶ã¤' },
        { hint: 'ç¯€è¶³å‹•ç‰©ã®ä½“ã®è¡¨é¢ã‚’ãŠãŠã†ã€ã‹ãŸã„æ§‹é€ ã€‚', answer: 'ãŒã„ã“ã£ã‹ã' },
        { hint: 'å†…è‡“ãŒã€Œå¤–ã¨ã†è†œã€ã«åŒ…ã¾ã‚Œã¦ã„ã‚‹å‹•ç‰©ã€‚', answer: 'ãªã‚“ãŸã„ã©ã†ã¶ã¤' },
        { hint: 'ã‚ã—ãŒ6æœ¬ã‚ã‚‹ç¯€è¶³å‹•ç‰©ã®ã‚°ãƒ«ãƒ¼ï¿½ï¿½ã€‚', answer: 'ã“ã‚“ã¡ã‚…ã†ã‚‹ã„' },
        { hint: 'ã‚¨ãƒ“ã‚„ã‚«ãƒ‹ãªã©ã®ç¯€è¶³å‹•ç‰©ã®ã‚°ãƒ«ãƒ¼ãƒ—ã€‚', answer: 'ã“ã†ã‹ãã‚‹ã„' },
        { hint: 'é­šé¡ãªã©ãŒæ°´ä¸­ã§å‘¼å¸ã‚’ã™ã‚‹ã¨ã“ã‚ã€‚', answer: 'ãˆã‚‰' },
        { hint: 'å“ºä¹³é¡ãªã©ãŒé™¸ä¸Šã§å‘¼å¸ã‚’ã™ã‚‹ã¨ã“ã‚ã€‚', answer: 'ã¯ã„' },
        { hint: 'å…±é€šç‚¹ã‚„ç›¸é•ç‚¹ã§ä»²é–“åˆ†ã‘ã‚’ã™ã‚‹ã“ã¨ã€‚', answer: 'ã¶ã‚“ã‚‹ã„' },
        { hint: 'è¦³å¯Ÿçµæœã‚’æ­£ç¢ºã«è¨˜éŒ²ã™ã‚‹å›³ã€‚', answer: 'ã™ã‘ã£ã¡' },
        { hint: 'é¡•å¾®é¡ã®ã€ç›®ã«è¿‘ã„æ–¹ã®ãƒ¬ãƒ³ã‚ºã€‚', answer: 'ã›ã¤ãŒã‚“ã‚Œã‚“ãš' },
        { hint: 'é¡•å¾®é¡ã®ã€è¦³å¯Ÿç‰©ã«è¿‘ã„æ–¹ã®ãƒ¬ãƒ³ã‚ºã€‚', answer: 'ãŸã„ã¶ã¤ã‚Œã‚“ãš' }
      ],
      matter: [
        { hint: 'ç‰©ä½“ã®ææ–™ã«æ³¨ç›®ã—ãŸã¨ãã®å‘¼ã³æ–¹ã€‚', answer: 'ã¶ã£ã—ã¤' },
        { hint: 'å½¢ã‚„ç”¨é€”ã«æ³¨ç›®ã—ãŸã¨ãã®å‘¼ã³æ–¹ã€‚', answer: 'ã¶ã£ãŸã„' },
        { hint: 'é‡‘å±ã‚’å¼•ã£å¼µã‚‹ã¨ç´°ãä¼¸ã³ã‚‹æ€§è³ªã€‚', answer: 'ãˆã‚“ã›ã„' },
        { hint: 'é‡‘å±ã‚’ãŸãŸãã¨è–„ãåºƒãŒã‚‹æ€§è³ªã€‚', answer: 'ã¦ã‚“ã›ã„' },
        { hint: 'å˜ä½ä½“ç©ã‚ãŸã‚Šã®ç‰©è³ªã®è³ªé‡ã€‚', answer: 'ã¿ã¤ã©' },
        { hint: 'ç‚­ç´ ã‚’å«ã¿ã€ç‡ƒãˆã‚‹ã¨äºŒé…¸åŒ–ç‚­ç´ ã‚’å‡ºã™ç‰©è³ªã€‚', answer: 'ã‚†ã†ãã¶ã¤' },
        { hint: 'æœ‰æ©Ÿç‰©ä»¥å¤–ã®ç‰©è³ªã€‚', answer: 'ã‚€ãã¶ã¤' },
        { hint: 'æ¶²ä½“ã«æº¶ã‘ã¦ã„ã‚‹ç‰©è³ªã€‚', answer: 'ã‚ˆã†ã—ã¤' },
        { hint: 'ç‰©è³ªã‚’æº¶ã‹ã—ã¦ã„ã‚‹æ¶²ä½“ã€‚', answer: 'ã‚ˆã†ã°ã„' },
        { hint: 'æº¶è³ªãŒæº¶åª’ã«æº¶ã‘ãŸæ¶²ä½“å…¨ä½“ã€‚', answer: 'ã‚ˆã†ãˆã' },
        { hint: 'æº¶åª’ãŒæ°´ã§ã‚ã‚‹æº¶æ¶²ã€‚', answer: 'ã™ã„ã‚ˆã†ãˆã' },
        { hint: 'æº¶æ¶²ã®æ¿ƒã•ï¼ˆå‰²åˆï¼‰ã€‚', answer: 'ã®ã†ã©' },
        { hint: 'ã„ãã¤ã‹ã®ç‰©è³ªãŒæ··ã˜ã‚Šåˆã£ãŸã‚‚ã®ã€‚', answer: 'ã“ã‚“ã”ã†ã¶ã¤' },
        { hint: 'è¦å‰‡æ­£ã—ã„å½¢ã‚’ã—ãŸå›ºä½“ã®ç‰©è³ªã€‚', answer: 'ã‘ã£ã—ã‚‡ã†' },
        { hint: 'ä¸€å®šé‡ã®æ°´ã«æº¶ã‘ã‚‹ç‰©è³ªã®æœ€å¤§è³ªé‡ã€‚', answer: 'ã‚ˆã†ã‹ã„ã©' },
        { hint: 'æº¶è§£åº¦ã¾ã§ç‰©è³ªãŒæº¶ã‘ã¦ã„ã‚‹çŠ¶æ…‹ã€‚', answer: 'ã»ã†ã‚' },
        { hint: 'ä¸€åº¦æº¶ã‹ã—ãŸç‰©è³ªã‚’å†ã³çµæ™¶ã¨ã—ã¦å‡ºã™ã“ã¨ã€‚', answer: 'ã•ã„ã‘ã£ã—ã‚‡ã†' },
        { hint: 'å›ºä½“ãŒæº¶ã‘ã¦æ¶²ä½“ã«å¤‰ã‚ã‚‹æ¸©åº¦ã€‚', answer: 'ã‚†ã†ã¦ã‚“' },
        { hint: 'æ¶²ä½“ãŒæ²¸é¨°ã—ã¦æ°—ä½“ã«å¤‰ã‚ã‚‹æ¸©åº¦ã€‚', answer: 'ãµã£ã¦ã‚“' },
        { hint: 'æ²¸ç‚¹ã®å·®ã‚’åˆ©ç”¨ã—ã¦æ¶²ä½“ã‚’åˆ†ã‘ã‚‹æ“ä½œã€‚', answer: 'ã˜ã‚‡ã†ã‚Šã‚…ã†' },
        { hint: 'äºŒé…¸åŒ–ç‚­ç´ ã‚’é€šã™ã¨ç™½ãæ¿ã‚‹æ¶²ä½“ã€‚', answer: 'ã›ã£ã‹ã„ã™ã„' },
        { hint: 'ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢æ°´ãŒç¤ºã™æ€§è³ªã€‚', answer: 'ã‚ã‚‹ã‹ã‚Š' },
        { hint: 'é…¸æ€§ã‚„ã‚¢ãƒ«ã‚«ãƒªæ€§ã‚’èª¿ã¹ã‚‹ãŸã‚ã®ç´™ã€‚', answer: 'ã‚Šã¨ã¾ã™ã—' },
        { hint: 'æ€¥ãªæ²¸é¨°ã‚’é˜²ããŸã‚ã«å…¥ã‚Œã‚‹çŸ³ã€‚', answer: 'ãµã£ã¨ã†ã›ã' }
      ],
      physics: [
        { hint: 'è‡ªã‚‰å…‰ã‚’å‡ºã™ç‰©ä½“ã€‚', answer: 'ã“ã†ã’ã‚“' },
        { hint: 'å…‰ãŒç‰©ä½“ã®è¡¨é¢ã§è·³ã­è¿”ã‚‹ç¾è±¡ã€‚', answer: 'ã¯ã‚“ã—ã‚ƒ' },
        { hint: 'å…‰ãŒé¡ãªã©ã«å…¥ã‚‹ã¨ãã®è§’åº¦ã€‚', answer: 'ã«ã‚…ã†ã—ã‚ƒã‹ã' },
        { hint: 'å¢ƒç•Œã§å…‰ãŒæŠ˜ã‚Œæ›²ãŒã£ã¦é€²ã‚€ç¾è±¡ã€‚', answer: 'ãã£ã›ã¤' },
        { hint: 'å¢ƒç•Œã§ã™ã¹ã¦ã®å…‰ãŒåå°„ã™ã‚‹ç¾è±¡ã€‚', answer: 'ãœã‚“ã¯ã‚“ã—ã‚ƒ' },
        { hint: 'ä¸­å¤®ãŒãµãã‚‰ã‚“ã ãƒ¬ãƒ³ã‚ºã€‚', answer: 'ã¨ã¤ã‚Œã‚“ãš' },
        { hint: 'ãƒ¬ãƒ³ã‚ºã®ä¸­å¿ƒã‚’é€šã‚Šã€é¢ã«å‚ç›´ãªç›´ç·šã€‚', answer: 'ã“ã†ã˜ã' },
        { hint: 'å…‰è»¸ã«å¹³è¡Œãªå…‰ãŒé›†ã¾ã‚‹ç‚¹ã€‚', answer: 'ã—ã‚‡ã†ã¦ã‚“' },
        { hint: 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã«æ˜ ã‚‹ã€ä¸Šä¸‹å·¦å³ãŒé€†ã®åƒã€‚', answer: 'ã˜ã¤ãã†' },
        { hint: 'ãƒ¬ãƒ³ã‚ºã‚’ã®ãã„ãŸã¨ãã«è¦‹ãˆã‚‹ã€å¤§ããªåƒã€‚', answer: 'ãã‚‡ãã†' },
        { hint: 'éŸ³ã‚’å‡ºã—ã¦ã„ã‚‹ç‰©ä½“ã€‚', answer: 'ãŠã‚“ã’ã‚“' },
        { hint: 'éŸ³ã®éœ‡ãˆã€‚', answer: 'ã—ã‚“ã©ã†' },
        { hint: 'éŸ³ã®æŒ¯å‹•ã®ã€ä¸­å¿ƒã‹ã‚‰ã®æœ€å¤§å¹…ã€‚', answer: 'ã—ã‚“ã·ã' },
        { hint: '1ç§’é–“ã«æŒ¯å‹•ã™ã‚‹å›æ•°ã€‚', answer: 'ã—ã‚“ã©ã†ã™ã†' },
        { hint: 'æŒ¯å‹•æ•°ã®å˜ä½ï¼ˆHzï¼‰ã€‚', answer: 'ã¸ã‚‹ã¤' },
        { hint: 'ç‰©ä½“ã‚’å¤‰å½¢ã•ã›ãŸã‚Šæ”¯ãˆãŸã‚Šã™ã‚‹ã‚‚ã®ã€‚', answer: 'ã¡ã‹ã‚‰' },
        { hint: 'å¤‰å½¢ã—ãŸç‰©ä½“ãŒã‚‚ã¨ã«æˆ»ã‚ã†ã¨ã™ã‚‹æ€§è³ªã€‚', answer: 'ã ã‚“ã›ã„' },
        { hint: 'å¤‰å½¢ã—ãŸç‰©ä½“ãŒã‚‚ã¨ã«æˆ»ã‚ã†ã¨ã™ã‚‹åŠ›ã€‚', answer: 'ã ã‚“ã›ã„ã‚Šã‚‡ã' },
        { hint: 'åœ°çƒãŒç‰©ä½“ã‚’ãã®ä¸­å¿ƒã«å¼•ãåŠ›ã€‚', answer: 'ã˜ã‚…ã†ã‚Šã‚‡ã' },
        { hint: 'ç£çŸ³ã®é–“ã§ã¯ãŸã‚‰ãåŠ›ã€‚', answer: 'ã˜ã‚Šã‚‡ã' },
        { hint: 'åŠ›ã®å¤§ãã•ã®å˜ä½ï¼ˆNï¼‰ã®èª­ã¿æ–¹ã€‚', answer: 'ã«ã‚…ãƒ¼ã¨ã‚“' },
        { hint: 'åŠ›ã®ã¯ãŸã‚‰ãç‰¹å®šã®ç‚¹ã€‚', answer: 'ã•ã‚ˆã†ã¦ã‚“' },
        { hint: 'ç‰©ä½“ãŒå‹•ã‹ãªã„ã¨ãã€2ã¤ã®åŠ›ã¯ã©ã®ã‚ˆã†ãªçŠ¶æ…‹ã‹ã€‚', answer: 'ã¤ã‚Šã‚ã„' },
        { hint: 'ç‰©ä½“ã®é‹å‹•ã‚’å¦¨ã’ã‚‹åŠ›ã€‚', answer: 'ã¾ã•ã¤ã‚Šã‚‡ã' },
        { hint: 'ã°ã­ã®ã®ã³ãŒåŠ›ã®å¤§ãã•ã«æ¯”ä¾‹ã™ã‚‹æ³•å‰‡ã€‚', answer: 'ãµã£ã' }
      ],
      earth: [
        { hint: 'åœ°ä¸‹ã®å²©çŸ³ãŒç†±ã§ã¨ã‘ãŸã‚‚ã®ã€‚', answer: 'ã¾ãã¾' },
        { hint: 'ãƒã‚°ãƒãŒåœ°è¡¨ã«æµã‚Œå‡ºãŸã‚‚ã®ã€‚', answer: 'ã‚ˆã†ãŒã‚“' },
        { hint: 'ãƒã‚°ãƒãŒå†·ãˆå›ºã¾ã£ã¦ã§ããŸå²©çŸ³ã®ç·ç§°ã€‚', answer: 'ã‹ã›ã„ãŒã‚“' },
        { hint: 'åœ°è¡¨ä»˜è¿‘ã§æ€¥ã«å†·ãˆã¦å›ºã¾ã£ãŸå²©çŸ³ã€‚', answer: 'ã‹ã–ã‚“ãŒã‚“' },
        { hint: 'åœ°ä¸‹æ·±ãã§ã‚†ã£ãã‚Šå†·ãˆã¦å›ºã¾ã£ãŸå²©çŸ³ã€‚', answer: 'ã—ã‚“ã›ã„ãŒã‚“' },
        { hint: 'ç«å±±å²©ã«å«ã¾ã‚Œã‚‹æ¯”è¼ƒçš„å¤§ããªçµæ™¶ã€‚', answer: 'ã¯ã‚“ã—ã‚‡ã†' },
        { hint: 'æ–‘æ™¶ã®ã¾ã‚ã‚Šã‚’åŸ‹ã‚ã‚‹ã€å¾®ç´°ãªéƒ¨åˆ†ã€‚', answer: 'ã›ã£ã' },
        { hint: 'ãƒã‚°ãƒãŒå†·ãˆã¦ã§ããŸã€è¦å‰‡æ­£ã—ã„å½¢ã®ç²’ã€‚', answer: 'ã“ã†ã¶ã¤' },
        { hint: 'å²©çŸ³ã«å«ã¾ã‚Œã‚‹ç™½ã„ä¸è¦å‰‡ãªå½¢ã®é‰±ç‰©ã€‚', answer: 'ã›ããˆã„' },
        { hint: 'å²©çŸ³ã«å«ã¾ã‚Œã‚‹ç™½ã„æ¿çŠ¶ã®å½¢ã®é‰±ç‰©ã€‚', answer: 'ã¡ã‚‡ã†ã›ã' },
        { hint: 'å²©çŸ³ã«å«ã¾ã‚Œã‚‹ã€é»’ã„æ¿çŠ¶ã®é‰±ç‰©ã€‚', answer: 'ãã‚ã†ã‚“ã‚‚' },
        { hint: 'åœ°éœ‡ãŒç™ºç”Ÿã—ãŸã€åœ°ä¸‹ã®å ´æ‰€ã€‚', answer: 'ã—ã‚“ã’ã‚“' },
        { hint: 'éœ‡æºã®çœŸä¸Šã®ã€åœ°è¡¨ã®åœ°ç‚¹ã€‚', answer: 'ã—ã‚“ãŠã†' },
        { hint: 'å„åœ°ç‚¹ã§ã®æºã‚Œã®å¤§ãã•ã®ç¨‹åº¦ã€‚', answer: 'ã—ã‚“ã©' },
        { hint: 'å¾Œã‹ã‚‰æ¥ã‚‹ã€å¤§ããªæºã‚Œã€‚', answer: 'ã—ã‚…ã‚ˆã†ã©ã†' },
        { hint: 'åœ°çƒã®è¡¨é¢ã‚’ãŠãŠã†å·¨å¤§ãªå²©ç›¤ã€‚', answer: 'ã·ã‚Œãƒ¼ã¨' },
        { hint: 'åœ°å±¤ã§å²©ç›¤ãŒå‰²ã‚Œã¦ãšã‚Œã‚‹ã“ã¨ã€‚', answer: 'ã ã‚“ãã†' },
        { hint: 'åœ°å±¤ãŒæŠ¼ã—æ›²ã’ã‚‰ã‚ŒãŸã‚‚ã®ã€‚', answer: 'ã—ã‚…ã†ãã‚‡ã' },
        { hint: 'ç¹°ã‚Šè¿”ã—å‹•ãå¯èƒ½æ€§ã®ã‚ã‚‹æ–­å±¤ã€‚', answer: 'ã‹ã¤ã ã‚“ãã†' },
        { hint: 'å¤§åœ°ã®è¡¨é¢ãŒæŒã¡ä¸ŠãŒã‚‹ã“ã¨ã€‚', answer: 'ã‚Šã‚…ã†ã' },
        { hint: 'å¤§åœ°ã®è¡¨é¢ãŒæ²ˆã‚€ã“ã¨ã€‚', answer: 'ã¡ã‚“ã“ã†' },
        { hint: 'åœ°éœ‡ã§ç™ºç”Ÿã™ã‚‹å¤§ããªæ³¢ã€‚', answer: 'ã¤ãªã¿' },
        { hint: 'å²©çŸ³ãŒæ°—æ¸©ã‚„é¢¨é›¨ã§ã‚‚ã‚ããªã‚‹ã“ã¨ã€‚', answer: 'ãµã†ã‹' },
        { hint: 'æ°´ã®æµã‚Œã§å²©çŸ³ãŒã‘ãšã‚‰ã‚Œã‚‹ã“ã¨ã€‚', answer: 'ã—ã‚“ã—ã‚‡ã' },
        { hint: 'åœŸç ‚ãŒä¸‹æµã¸é‹ã°ã‚Œã‚‹ã“ã¨ã€‚', answer: 'ã†ã‚“ã±ã‚“' },
        { hint: 'åœŸç ‚ãŒæµã‚Œã®ç·©ã„å ´æ‰€ã«ãŸã¾ã‚‹ã“ã¨ã€‚', answer: 'ãŸã„ã›ã' },
        { hint: 'å †ç©ç‰©ãŒç©ã¿é‡ãªã£ã¦ã§ããŸå±¤ã€‚', answer: 'ã¡ãã†' },
        { hint: 'å †ç©ç‰©ãŒå›ºã¾ã£ã¦ã§ããŸå²©çŸ³ã€‚', answer: 'ãŸã„ã›ããŒã‚“' },
        { hint: 'ç”Ÿç‰©ã®æ­»ãŒã„ã‚„å·£ç©´ã®è·¡ã€‚', answer: 'ã‹ã›ã' },
        { hint: 'å½“æ™‚ã®ç’°å¢ƒã‚’ç¤ºã™åŒ–çŸ³ã€‚', answer: 'ã—ãã†ã‹ã›ã' },
        { hint: 'å½“æ™‚ã®æ™‚ä»£ã‚’ç¤ºã™åŒ–çŸ³ã€‚', answer: 'ã—ã˜ã‚…ã‚“ã‹ã›ã' },
        { hint: 'ç«å±±ç°ãŒå›ºã¾ã£ã¦ã§ããŸå²©çŸ³ã€‚', answer: 'ãã‚‡ã†ã‹ã„ãŒã‚“' },
        { hint: 'åœ°å±¤ãŒè¦‹ãˆã¦ã„ã‚‹å´–ãªã©ã®å ´æ‰€ã€‚', answer: 'ã‚ã¨ã†' },
        { hint: 'åœ°å±¤ã®é‡ãªã‚Šæ–¹ã‚’æŸ±çŠ¶ã«è¡¨ã—ãŸå›³ã€‚', answer: 'ã¡ã‚…ã†ã˜ã‚‡ã†ãš' }
      ]
    };

    // ã²ã‚‰ãŒãªã‚’1æ–‡å­—ãšã¤ãƒ­ãƒ¼ãƒå­—ã®é¸æŠè‚¢ã«åˆ†è§£
    function convertHiraganaToRomajiArray(hiragana) {
      const result = [];
      let i = 0;
      
      while (i < hiragana.length) {
        let matched = false;
        
        // ä¿ƒéŸ³ã€Œã£ã€ã®å‡¦ç†
        if (hiragana[i] === 'ã£' && i < hiragana.length - 1) {
          const nextChar = hiragana[i + 1];
          // æ¬¡ã®æ–‡å­—ã®å­éŸ³ã‚’é‡ã­ã‚‹
          let consonants = [];
          
          // 2æ–‡å­—ã®çµ„ã¿åˆã‚ã›ã‚’ãƒã‚§ãƒƒã‚¯
          if (i + 2 < hiragana.length) {
            const twoChar = hiragana.substring(i + 1, i + 3);
            if (hiraganaToRomaji[twoChar]) {
              const firstRomaji = hiraganaToRomaji[twoChar][0];
              consonants.push(firstRomaji[0]);
            }
          }
          
          // 1æ–‡å­—ã®å­éŸ³ã‚’å–å¾—
          if (hiraganaToRomaji[nextChar]) {
            const firstRomaji = hiraganaToRomaji[nextChar][0];
            consonants.push(firstRomaji[0]);
          }
          
          if (consonants.length > 0) {
            result.push({
              hiragana: 'ã£',
              romaji: [consonants[0], 'ltu', 'xtu'],
              length: 1
            });
            i += 1;
            matched = true;
            continue;
          }
        }
        
        // 2æ–‡å­—ã®çµ„ã¿åˆã‚ã›ã‚’å„ªå…ˆãƒã‚§ãƒƒã‚¯ï¼ˆæ‹—éŸ³ãªã©ï¼‰
        if (i < hiragana.length - 1) {
          const twoChar = hiragana.substring(i, i + 2);
          if (hiraganaToRomaji[twoChar]) {
            result.push({
              hiragana: twoChar,
              romaji: hiraganaToRomaji[twoChar],
              length: 2
            });
            i += 2;
            matched = true;
            continue;
          }
        }
        
        // 1æ–‡å­—ãƒã‚§ãƒƒã‚¯
        const oneChar = hiragana[i];
        if (hiraganaToRomaji[oneChar]) {
          result.push({
            hiragana: oneChar,
            romaji: hiraganaToRomaji[oneChar],
            length: 1
          });
          i += 1;
          matched = true;
        } else {
          i += 1;
        }
      }
      
      return result;
    }

    // ã‚¹ã‚³ã‚¢ã‹ã‚‰åˆ°é”æƒ‘æ˜Ÿã‚’å–å¾—
    function getPlanetByScore(score) {
      for (let i = planets.length - 1; i >= 0; i--) {
        if (score >= planets[i].distance) {
          return planets[i];
        }
      }
      return planets[0];
    }

    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
    let gameState = {
      isPlaying: false,
      currentWord: null,
      romajiArray: [],
      currentCharIndex: 0,
      currentRomajiInput: '',
      score: 0,
      timeLeft: 60,
      totalTyped: 0,
      correctTyped: 0,
      combo: 0,
      maxCombo: 0,
      timer: null,
      hintTimer: null,
      hintShown: false,
      usedWords: [],
      selectedCourse: null
    };

    // ã‚¹ã‚³ã‚¢å±¥æ­´ï¼ˆã‚³ãƒ¼ã‚¹åˆ¥ï¼‰
    let scoreHistory = {};
    let isTop10 = false;
    let pendingScore = null;

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        // ã‚³ãƒ¼ã‚¹åˆ¥ã«åˆ†é¡
        scoreHistory = {
          creature: [],
          matter: [],
          physics: [],
          earth: []
        };
        
        data.forEach(record => {
          const course = record.course || 'creature';
          if (scoreHistory[course]) {
            scoreHistory[course].push(record);
          }
        });
        
        // å„ã‚³ãƒ¼ã‚¹ã‚’ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
        Object.keys(scoreHistory).forEach(course => {
          scoreHistory[course].sort((a, b) => b.score - a.score);
        });
        
        updateBestScoresDisplay();
      }
    };

    // Data SDKåˆæœŸåŒ–
    async function initDataSdk() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Data SDK initialization failed');
        }
      }
    }

    // ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
    function updateBestScoresDisplay() {
      const bestScoresListEl = document.getElementById('best-scores-list');
      if (!bestScoresListEl || !gameState.selectedCourse) return;

      const courseScores = scoreHistory[gameState.selectedCourse] || [];
      
      if (courseScores.length === 0) {
        bestScoresListEl.innerHTML = '<div class="text-center text-gray-500">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }

      const top10 = courseScores.slice(0, 10);
      bestScoresListEl.innerHTML = top10.map((record, index) => {
        const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
        const medal = index < 3 ? medals[index] : `${index + 1}ä½`;
        const nickname = record.nickname || 'åç„¡ã—';
        return `
          <div class="flex items-center justify-between p-3 rounded-lg" style="background: rgba(255, 255, 255, 0.05);">
            <div class="flex items-center gap-3">
              <span class="text-2xl w-12">${medal}</span>
              <span class="text-lg">${record.planet_emoji} ${record.planet_name}</span>
              <span class="text-sm" style="color: #00ffff;">${nickname}</span>
            </div>
            <span class="font-game text-xl" style="color: #00ffff;">${record.score}</span>
          </div>
        `;
      }).join('');
    }

    // ã‚¹ã‚³ã‚¢ã‚’ä¿å­˜
    async function saveScore(score, planetName, planetEmoji, nickname) {
      if (!window.dataSdk || !gameState.selectedCourse) return;

      const submitBtn = document.getElementById('submit-nickname-btn');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'ç™»éŒ²ä¸­...';
      }

      const createResult = await window.dataSdk.create({
        score: score,
        planet_name: planetName,
        planet_emoji: planetEmoji,
        course: gameState.selectedCourse,
        nickname: nickname || 'åç„¡ã—',
        timestamp: new Date().toISOString()
      });

      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ç™»éŒ²';
      }

      if (!createResult.isOk) {
        console.error('Failed to save score');
      } else {
        // ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
        const nicknameForm = document.getElementById('nickname-form');
        if (nicknameForm) {
          nicknameForm.classList.add('hidden');
        }
      }
    }

    // ãƒˆãƒƒãƒ—10ã«å…¥ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    function checkTop10(score) {
      if (!gameState.selectedCourse) return false;
      const courseScores = scoreHistory[gameState.selectedCourse] || [];
      
      if (courseScores.length < 10) return true;
      
      const top10th = courseScores[9];
      return score > top10th.score;
    }

    // DOMè¦ç´ 
    const startScreen = document.getElementById('start-screen');
    const courseScreen = document.getElementById('course-screen');
    const gameScreen = document.getElementById('game-screen');
    const resultScreen = document.getElementById('result-screen');
    const startBtn = document.getElementById('start-btn');
    const backToStartBtn = document.getElementById('back-to-start-btn');
    const retryBtn = document.getElementById('retry-btn');
    const hiddenInput = document.getElementById('hidden-input');
    const currentWordEl = document.getElementById('current-word');
    const wordHintEl = document.getElementById('word-hint');
    const answerHintEl = document.getElementById('answer-hint');
    const inputDisplayEl = document.getElementById('input-display');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');
    const accuracyEl = document.getElementById('accuracy');
    const comboCountEl = document.getElementById('combo-count');
    const signBoardEl = document.getElementById('sign-board');
    const spaceshipEl = document.getElementById('spaceship');
    const locationEl = document.getElementById('location');
    const planetBgEl = document.getElementById('planet-bg');
    const progressGaugeEl = document.getElementById('progress-gauge');
    const shipMarkerEl = document.getElementById('ship-marker');
    const planetMarkersEl = document.getElementById('planet-markers');
    const gaugePlanetNameEl = document.getElementById('gauge-planet-name');
    const nicknameInput = document.getElementById('nickname-input');
    const submitNicknameBtn = document.getElementById('submit-nickname-btn');
    const nicknameForm = document.getElementById('nickname-form');

    // ã‚µã‚¤ãƒ‰ã‚²ãƒ¼ã‚¸ã®åˆæœŸåŒ–
    function initializeGauge() {
      if (!planetMarkersEl) return;
      
      planetMarkersEl.innerHTML = '';
      const maxDistance = planets[planets.length - 1].distance;
      
      planets.forEach(planet => {
        const position = (planet.distance / maxDistance) * 100;
        const marker = document.createElement('div');
        marker.className = 'absolute left-1/2 transform -translate-x-1/2 flex items-center';
        marker.style.bottom = `${position}%`;
        marker.innerHTML = `
          <div class="text-xl" style="text-shadow: 0 0 10px ${planet.color};">${planet.emoji}</div>
        `;
        planetMarkersEl.appendChild(marker);
      });
    }

    // ã‚²ãƒ¼ã‚¸æ›´æ–°
    function updateGauge() {
      if (!progressGaugeEl || !shipMarkerEl || !gaugePlanetNameEl) return;
      
      const maxDistance = planets[planets.length - 1].distance;
      const progress = Math.min((gameState.score / maxDistance) * 100, 100);
      
      progressGaugeEl.style.height = `${progress}%`;
      shipMarkerEl.style.bottom = `${progress}%`;
      
      const currentPlanet = getPlanetByScore(gameState.score);
      gaugePlanetNameEl.textContent = `${currentPlanet.emoji} ${currentPlanet.name}`;
      gaugePlanetNameEl.style.color = currentPlanet.color;
    }

    // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ - ã‚³ãƒ¼ã‚¹é¸æŠç”»é¢ã¸
    startBtn.addEventListener('click', () => {
      startScreen.classList.add('hidden');
      courseScreen.classList.remove('hidden');
    });

    // ã‚³ãƒ¼ã‚¹é¸æŠ
    document.querySelectorAll('.course-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        gameState.selectedCourse = btn.getAttribute('data-course');
        courseScreen.classList.add('hidden');
        startGame();
      });
    });

    // ã‚‚ã©ã‚‹ãƒœã‚¿ãƒ³
    backToStartBtn.addEventListener('click', () => {
      courseScreen.classList.add('hidden');
      startScreen.classList.remove('hidden');
    });

    // ã‚²ãƒ¼ãƒ é–‹å§‹
    function startGame() {
      gameState = {
        isPlaying: true,
        currentWord: null,
        romajiArray: [],
        currentCharIndex: 0,
        currentRomajiInput: '',
        score: 0,
        timeLeft: 60,
        totalTyped: 0,
        correctTyped: 0,
        combo: 0,
        maxCombo: 0,
        timer: null,
        hintTimer: null,
        hintShown: false,
        usedWords: [],
        selectedCourse: gameState.selectedCourse
      };

      resultScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');

      initializeGauge();
      updateScore();
      updateTimer();
      updateAccuracy();
      updateCombo();
      updateLocation();
      updateGauge();
      nextWord();

      hiddenInput.value = '';
      hiddenInput.focus();

      gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        updateTimer();
        if (gameState.timeLeft <= 0) {
          endGame();
        }
      }, 1000);
    }

    // æ¬¡ã®å˜èª
    function nextWord() {
      if (gameState.hintTimer) {
        clearTimeout(gameState.hintTimer);
      }
      
      const words = wordsByCourse[gameState.selectedCourse] || wordsByCourse.creature;
      
      // å…¨å•é¡Œã‚’ä½¿ã„åˆ‡ã£ãŸå ´åˆï¿½ï¿½ãƒªã‚»ãƒƒãƒˆ
      if (gameState.usedWords.length >= words.length) {
        gameState.usedWords = [];
      }
      
      // æœªä½¿ç”¨ã®å•é¡Œã‹ã‚‰é¸æŠ
      let availableWords = words.filter((word, index) => !gameState.usedWords.includes(index));
      const randomIndex = Math.floor(Math.random() * availableWords.length);
      const selectedWord = availableWords[randomIndex];
      const originalIndex = words.indexOf(selectedWord);
      
      gameState.usedWords.push(originalIndex);
      gameState.currentWord = selectedWord;
      gameState.romajiArray = convertHiraganaToRomajiArray(selectedWord.answer);
      gameState.currentCharIndex = 0;
      gameState.currentRomajiInput = '';
      gameState.hintShown = false;
      
      renderWord();
      wordHintEl.textContent = gameState.currentWord.hint;
      inputDisplayEl.textContent = 'å…¥åŠ›ã—ã¦ãã ã•ã„...';
      inputDisplayEl.style.color = 'rgba(255, 255, 255, 0.6)';
      
      answerHintEl.style.opacity = '0';
      answerHintEl.textContent = '';
      
      gameState.hintTimer = setTimeout(() => {
        if (gameState.isPlaying && gameState.currentWord === selectedWord) {
          showHint();
        }
      }, 5000);
    }

    // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
    function showHint() {
      gameState.hintShown = true;
      const romajiHint = gameState.romajiArray.map(r => r.romaji[0]).join('');
      answerHintEl.textContent = `ãƒ’ãƒ³ãƒˆï¼š${gameState.currentWord.answer}ï¼ˆ${romajiHint}ï¼‰`;
      answerHintEl.style.opacity = '1';
      answerHintEl.classList.add('animate-fadeIn');
    }

    // å˜èªã®æç”»
    function renderWord() {
      const answer = gameState.currentWord.answer;
      let html = '';
      let hiraganaIndex = 0;
      
      for (let i = 0; i < gameState.romajiArray.length; i++) {
        const charInfo = gameState.romajiArray[i];
        let charClass = 'char-pending';
        let style = 'color: rgba(255, 255, 255, 0.4);';
        let displayChar = charInfo.hiragana;
        
        if (i < gameState.currentCharIndex) {
          // æ­£è§£æ¸ˆã¿ã®æ–‡å­—
          charClass = 'char-correct';
          style = 'color: #00ff88; text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);';
        } else if (i === gameState.currentCharIndex) {
          // å…¥åŠ›ä¸­ã®æ–‡å­—
          if (gameState.hintShown || gameState.currentCharIndex > 0) {
            // ãƒ’ãƒ³ãƒˆè¡¨ç¤ºå¾Œ or 1æ–‡å­—ç›®ã‚’æ­£ï¿½ï¿½ï¿½ã—ãŸå¾Œã¯è¡¨ç¤º
            charClass = 'char-current';
            style = 'color: #ffd700; text-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.6); border-bottom: 4px solid #ffd700; display: inline-block; padding-bottom: 2px; transform: scale(1.2);';
          } else {
            // æœ€åˆã¯ä¼ã›ã‚‹
            displayChar = 'â—'.repeat(charInfo.hiragana.length);
            charClass = 'char-current';
            style = 'color: #ffd700; text-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.6); border-bottom: 4px solid #ffd700; display: inline-block; padding-bottom: 2px; transform: scale(1.2);';
          }
        } else {
          // æœªå…¥åŠ›ã®æ–‡å­—
          if (gameState.hintShown || gameState.currentCharIndex > 0) {
            // ãƒ’ãƒ³ãƒˆè¡¨ç¤ºå¾Œ or 1æ–‡å­—ç›®ã‚’æ­£è§£ã—ãŸå¾Œã¯è¡¨ç¤º
            charClass = 'char-pending';
            style = 'color: rgba(255, 255, 255, 0.4);';
          } else {
            // æœ€åˆã¯ä¼ã›ã‚‹
            displayChar = 'â—'.repeat(charInfo.hiragana.length);
          }
        }
        
        html += `<span class="${charClass}" style="${style}">${displayChar}</span>`;
        hiraganaIndex += charInfo.length;
      }
      
      currentWordEl.innerHTML = html;
    }

    // ã‚­ãƒ¼å…¥åŠ›å‡¦ç†
    function handleInput(e) {
      if (!gameState.isPlaying || !gameState.currentWord) return;

      const key = e.key;
      if (key.length !== 1 || !/[a-z]/i.test(key)) return;

      gameState.totalTyped++;
      const typedLower = key.toLowerCase();
      gameState.currentRomajiInput += typedLower;

      // ç¾åœ¨å…¥åŠ›ä¸­ã®ã²ã‚‰ãŒãªã«å¯¾å¿œã™ã‚‹å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
      const currentChar = gameState.romajiArray[gameState.currentCharIndex];
      const possibleRomaji = currentChar.romaji;

      let matched = false;
      let completed = false;

      for (const pattern of possibleRomaji) {
        if (pattern.startsWith(gameState.currentRomajiInput)) {
          matched = true;
          if (pattern === gameState.currentRomajiInput) {
            completed = true;
            break;
          }
        }
      }

      if (completed) {
        // æ–‡å­—å®Œæˆ
        gameState.correctTyped++;
        gameState.combo++;
        gameState.score += 10 + Math.floor(gameState.combo / 5) * 5;
        
        if (gameState.combo > gameState.maxCombo) {
          gameState.maxCombo = gameState.combo;
        }

        // å®‡å®™èˆ¹ã‚’å‰é€²
        spaceshipEl.classList.add('animate-ship-move');
        setTimeout(() => spaceshipEl.classList.remove('animate-ship-move'), 500);

        gameState.currentCharIndex++;
        gameState.currentRomajiInput = '';

        // 1æ–‡å­—ç›®ã‚’æ­£è§£ã—ãŸã‚‰ãƒ’ãƒ³ãƒˆã‚’è‡ªå‹•è¡¨ç¤º
        if (gameState.currentCharIndex === 1 && !gameState.hintShown) {
          if (gameState.hintTimer) {
            clearTimeout(gameState.hintTimer);
          }
          showHint();
        }

        if (gameState.currentCharIndex >= gameState.romajiArray.length) {
          // å˜èªå®Œæˆ
          gameState.score += 50;
          signBoardEl.classList.add('animate-explosion');
          setTimeout(() => {
            signBoardEl.classList.remove('animate-explosion');
            nextWord();
          }, 500);
        } else {
          renderWord();
        }

        inputDisplayEl.textContent = 'âœ“';
        inputDisplayEl.style.color = config.primary_color || defaultConfig.primary_color;
      } else if (matched) {
        // å…¥åŠ›ä¸­
        gameState.correctTyped++;
        inputDisplayEl.textContent = gameState.currentRomajiInput;
        inputDisplayEl.style.color = config.accent_color || defaultConfig.accent_color;
      } else {
        // ãƒŸã‚¹
        gameState.combo = 0;
        gameState.currentRomajiInput = '';
        signBoardEl.classList.add('animate-shake');
        setTimeout(() => signBoardEl.classList.remove('animate-shake'), 400);
        
        inputDisplayEl.textContent = 'ãƒŸã‚¹ï¼';
        inputDisplayEl.style.color = '#ff4757';
      }

      updateScore();
      updateAccuracy();
      updateCombo();
      updateLocation();
      updateGauge();
    }

    // ã‚¹ã‚³ã‚¢æ›´æ–°
    function updateScore() {
      scoreEl.textContent = gameState.score;
    }

    // ä½ç½®æ›´æ–°
    function updateLocation() {
      const planet = getPlanetByScore(gameState.score);
      locationEl.textContent = `${planet.emoji} ${planet.name}`;
      locationEl.style.color = planet.color;
      
      // èƒŒæ™¯ã®æƒ‘æ˜Ÿã‚‚æ›´æ–°
      planetBgEl.textContent = planet.emoji;
      planetBgEl.style.opacity = '0.15';
    }

    // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
    function updateTimer() {
      timerEl.textContent = gameState.timeLeft;
      if (gameState.timeLeft <= 10) {
        timerEl.style.color = '#ff4757';
      } else {
        timerEl.style.color = config.danger_color || defaultConfig.danger_color;
      }
    }

    // æ­£ç¢ºç‡æ›´æ–°
    function updateAccuracy() {
      const accuracy = gameState.totalTyped > 0 
        ? Math.round((gameState.correctTyped / gameState.totalTyped) * 100) 
        : 100;
      accuracyEl.textContent = accuracy + '%';
    }

    // ã‚³ãƒ³ãƒœæ›´æ–°
    function updateCombo() {
      if (gameState.combo >= 5) {
        comboCountEl.textContent = `ğŸ”¥ ${gameState.combo} COMBO!`;
      } else {
        comboCountEl.textContent = '';
      }
    }

    // ãƒ•ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function playFlightAnimation(targetScore) {
      return new Promise((resolve) => {
        const flightAnimationEl = document.getElementById('flight-animation');
        const flightRocketEl = document.getElementById('flight-rocket');
        const flightPlanetsEl = document.getElementById('flight-planets');
        
        if (!flightAnimationEl || !flightRocketEl || !flightPlanetsEl) {
          resolve();
          return;
        }

        flightAnimationEl.classList.remove('hidden');
        
        // æƒ‘æ˜Ÿãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®
        const maxDistance = planets[planets.length - 1].distance;
        flightPlanetsEl.innerHTML = '';
        
        planets.forEach(planet => {
          const position = (planet.distance / maxDistance) * 100;
          const marker = document.createElement('div');
          marker.className = 'absolute left-1/2 transform -translate-x-1/2 text-3xl';
          marker.style.bottom = `${position}%`;
          marker.textContent = planet.emoji;
          marker.style.opacity = '0';
          flightPlanetsEl.appendChild(marker);
        });

        // ç›®æ¨™ä½ç½®ã‚’è¨ˆç®—
        const targetPosition = Math.min((targetScore / maxDistance) * 100, 100);
        flightRocketEl.style.setProperty('--flight-end', `${targetPosition}%`);
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        flightRocketEl.style.animation = 'rocket-flight 3s ease-in-out forwards';
        
        // æƒ‘æ˜Ÿã‚’é †ç•ªã«è¡¨ç¤º
        let delay = 0;
        planets.forEach((planet, index) => {
          if (targetScore >= planet.distance) {
            setTimeout(() => {
              const markers = flightPlanetsEl.children;
              if (markers[index]) {
                markers[index].style.animation = 'planet-pass 1s ease-in-out forwards';
              }
            }, delay);
            delay += 500;
          }
        });

        setTimeout(() => {
          flightAnimationEl.classList.add('hidden');
          flightRocketEl.style.animation = '';
          resolve();
        }, 3500);
      });
    }

    // ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ç™»éŒ²
    submitNicknameBtn.addEventListener('click', async () => {
      const nickname = nicknameInput.value.trim();
      if (pendingScore) {
        await saveScore(
          pendingScore.score,
          pendingScore.planetName,
          pendingScore.planetEmoji,
          nickname
        );
        pendingScore = null;
      }
    });

    // Enterã‚­ãƒ¼ã§ã‚‚ç™»éŒ²
    nicknameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        submitNicknameBtn.click();
      }
    });

    // ã‚²ãƒ¼ãƒ çµ‚äº†
    async function endGame() {
      gameState.isPlaying = false;
      clearInterval(gameState.timer);
      if (gameState.hintTimer) {
        clearTimeout(gameState.hintTimer);
      }

      const finalPlanet = getPlanetByScore(gameState.score);
      
      // ãƒˆãƒƒãƒ—10ã«å…¥ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      isTop10 = checkTop10(gameState.score);
      
      gameScreen.classList.add('hidden');
      resultScreen.classList.remove('hidden');

      // ãƒ•ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
      await playFlightAnimation(gameState.score);
      
      document.getElementById('final-planet-emoji').textContent = finalPlanet.emoji;
      document.getElementById('final-planet-emoji').classList.add('animate-planet-arrive');
      document.getElementById('final-location').textContent = `åˆ°é”åœ°ç‚¹ï¼š${finalPlanet.emoji} ${finalPlanet.name}`;
      document.getElementById('final-location').style.color = finalPlanet.color;
      
      // æ–°è¨˜éŒ²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
      const newRecordMessageEl = document.getElementById('new-record-message');
      if (newRecordMessageEl && nicknameForm) {
        if (isTop10) {
          newRecordMessageEl.classList.remove('hidden');
          nicknameForm.classList.remove('hidden');
          nicknameInput.value = '';
          nicknameInput.focus();
          
          // ã‚¹ã‚³ã‚¢ã‚’ä¸€æ™‚ä¿å­˜
          pendingScore = {
            score: gameState.score,
            planetName: finalPlanet.name,
            planetEmoji: finalPlanet.emoji
          };
        } else {
          newRecordMessageEl.classList.add('hidden');
          nicknameForm.classList.add('hidden');
          // ãƒˆãƒƒãƒ—10ã«å…¥ã‚‰ãªã„å ´åˆã¯ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãªã—ã§ä¿å­˜
          await saveScore(gameState.score, finalPlanet.name, finalPlanet.emoji, null);
        }
      }
      
      document.getElementById('final-score').textContent = gameState.score;
      document.getElementById('final-typed').textContent = gameState.correctTyped;
      document.getElementById('final-accuracy').textContent = 
        (gameState.totalTyped > 0 ? Math.round((gameState.correctTyped / gameState.totalTyped) * 100) : 100) + '%';
      document.getElementById('final-combo').textContent = gameState.maxCombo;
      
      updateBestScoresDisplay();
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    retryBtn.addEventListener('click', () => {
      resultScreen.classList.add('hidden');
      courseScreen.classList.remove('hidden');
    });
    
    document.addEventListener('keydown', handleInput);
    
    document.getElementById('app').addEventListener('click', () => {
      if (gameState.isPlaying) {
        hiddenInput.focus();
      }
    });

    // Element SDK
    async function onConfigChange(newConfig) {
      const titleEl = document.getElementById('title');
      const startBtnEl = document.getElementById('start-btn');
      const appEl = document.getElementById('app');
      
      if (titleEl) {
        titleEl.textContent = newConfig.game_title || defaultConfig.game_title;
        titleEl.style.color = newConfig.primary_color || defaultConfig.primary_color;
        titleEl.style.textShadow = `0 0 40px ${newConfig.primary_color || defaultConfig.primary_color}80, 0 0 80px ${newConfig.primary_color || defaultConfig.primary_color}40`;
      }
      
      if (startBtnEl) {
        startBtnEl.textContent = newConfig.start_button_text || defaultConfig.start_button_text;
        startBtnEl.style.background = `linear-gradient(135deg, ${newConfig.primary_color || defaultConfig.primary_color} 0%, #0099ff 100%)`;
      }
      
      if (appEl) {
        appEl.style.background = `linear-gradient(180deg, ${newConfig.background_start || defaultConfig.background_start} 0%, ${newConfig.background_end || defaultConfig.background_end} 100%)`;
      }
      
      if (scoreEl) {
        scoreEl.style.color = newConfig.primary_color || defaultConfig.primary_color;
      }
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_start || defaultConfig.background_start,
            set: (value) => {
              cfg.background_start = value;
              if (window.elementSdk) window.elementSdk.setConfig({ background_start: value });
            }
          },
          {
            get: () => cfg.primary_color || defaultConfig.primary_color,
            set: (value) => {
              cfg.primary_color = value;
              if (window.elementSdk) window.elementSdk.setConfig({ primary_color: value });
            }
          },
          {
            get: () => cfg.accent_color || defaultConfig.accent_color,
            set: (value) => {
              cfg.accent_color = value;
              if (window.elementSdk) window.elementSdk.setConfig({ accent_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['game_title', cfg.game_title || defaultConfig.game_title],
        ['start_button_text', cfg.start_button_text || defaultConfig.start_button_text]
      ]);
    }

    // SDKåˆæœŸåŒ–
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
      config = window.elementSdk.config || defaultConfig;
    }

    // Data SDKåˆæœŸåŒ–
    initDataSdk();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c75d296b65b38f1',t:'MTc2OTk5NDc3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>